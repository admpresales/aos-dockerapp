# This section contains your application metadata.
# Version of the application
version: 2.1.0-beta
# Name of the application
name: intellij
# A short description of the application
description: "Intellij IDEA installed with LeanFT and other development plugins"
# Namespace to use when pushing to a registry. This is typically your Hub username.
namespace: "admpresales"
# List of application maitainers with name and email for each
maintainers:
  - name: Jason Hrabi
    email: jason.hrabi@microfocus.com
# Specify false here if your application doesn't support Swarm or Kubernetes
targets:
  swarm: false
  kubernetes: false

---
# This section contains the Compose file that describes your application services.
version: '3.5'
services:
  intellij:
      privileged: true
      image: ${INTELLIJ_IMAGE}:${INTELLIJ_TAG}
      ports:
        - "${OBJECTSPY_PORT}:8824"
        - "${UFTDEV_ENGINE_PORT}:5095"
      container_name: ${INTELLIJ_CONTAINER_NAME}
      depends_on:
          - devtools
          - sca
      environment:
        - "DISPLAY=unix$${DISPLAY}"
        - "LFT_LIC_ID=${LFT_LIC_ID}"
        - "LFT_LIC_ID_VERSION=${LFT_LIC_ID_VERSION}"
        - "LFT_LIC_SERVER=${LFT_LIC_SERVER}"
        - LD_LIBRARY_PATH=/devtools
        - SCA_VERSION=${SCA_TAG}
      network_mode: "host"
      volumes:
        - /tmp/.X11-unix:/tmp/.X11-unix
        - sca:/sca
        - devtools:/devtools
        - sca-plugin:/opt/intellij/plugins/FortifyAnalysis
  sca:
    image: ${SCA_IMAGE}:${SCA_TAG}
    container_name: ${SCA_CONTAINER_NAME}
    networks:
        demo-net:
    extra_hosts:
        - "nimbusserver.aos.com:172.50.0.1"
        - "nimbusserver:172.50.0.1"
    volumes:
        - sca:/opt/Fortify/Fortify_SCA_and_Apps_19.1.2
        - sca-plugin:/intellij-plugin/FortifyAnalysis
  devtools:
    image: ${DEVTOOLS_IMAGE}:${DEVTOOLS_TAG}
    container_name: ${DEVTOOLS_CONTAINER_NAME}
    command: bash -c "tail -f /dev/null"
    networks:
        demo-net:
    extra_hosts:
        - "nimbusserver.aos.com:172.50.0.1"
        - "nimbusserver:172.50.0.1"
    volumes:
        - devtools:/usr/lib

networks:
   demo-net:
     external: true

volumes:
    sca:
    sca-plugin:
    devtools:

---
# This section contains the default values for your application settings.
INTELLIJ_CONTAINER_NAME: intellij
INTELLIJ_TAG: 2.1.0
INTELLIJ_IMAGE: admpresales/intellij
OBJECTSPY_PORT: 8824
UFTDEV_ENGINE_PORT: 5095
LFT_LIC_ID: 23078
LFT_LIC_ID_VERSION: 1
LFT_LIC_SERVER: nimbusserver.aos.com
SCA_TAG: "19.1.2"
SCA_CONTAINER_NAME: intellij-sca
SCA_IMAGE: admpresales/sca
DEVTOOLS_CONTAINER_NAME: intellij-devtools
DEVTOOLS_IMAGE: admpresales/devtools
DEVTOOLS_TAG: "2.1"